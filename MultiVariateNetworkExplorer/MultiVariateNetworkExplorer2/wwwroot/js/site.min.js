const toggleNetworkInput=function(){$("#mvn-input-section").toggleClass("active-block");hideAllInputForms()},hideAllInputForms=function(){$("#mvn-input-section form.active-flex").removeClass("active-flex")},openNetworkInputForm=function(formId){toggleNetworkInput();$("#"+formId).addClass("active-flex")},addCollapsibleEventListeners=function(){const parameter_collapsibles=document.getElementsByClassName("collapsible-parameters-btn");for(const parameter_collapsible of parameter_collapsibles)parameter_collapsible.addEventListener("click",function(){this.classList.toggle("collapsible-parameters-btn-active");const content=this.nextElementSibling;content.style.height=content.clientHeight?0:content.scrollHeight+"px"})},addFileButtonsEventListeners=function(){const inputs=document.getElementsByClassName("inputfile");for(const input of inputs){const label=input.nextElementSibling,labelTextElement=label.firstElementChild,labelVal=labelTextElement.innerHTML,labelTooltip=label.nextElementSibling;input.addEventListener("change",function(e){let fileName="";fileName=e.target.value.split("\\").pop();fileName?(labelTextElement.innerText=fileName,labelTooltip.innerHTML=fileName,label.style.backgroundColor="green"):labelTextElement.innerText=labelVal});label.addEventListener("mouseover",function(){label.style.backgroundColor==="green"&&(labelTooltip.style.visibility="visible")});label.addEventListener("mouseout",function(){labelTooltip.style.visibility="hidden"})}},selectFocusIn=function(select_element){select_element.style.textAlign="left"},selectFocusOut=function(select_element){select_element.style.textAlign="center"},recalculateCollapsibleContentHeight=function(collapsible_content_id){const content=document.getElementById(collapsible_content_id);content.style.height="auto"},hideConversionParameters=function(parameter_container,parameter_div_class){const parameters_divs=parameter_container.querySelectorAll("."+parameter_div_class);for(const parameters_div of parameters_divs){parameters_div.style.display="none";const inputs=parameters_div.querySelectorAll("input");for(const input of inputs)input.disabled=!0}},displayParametersElements=function(parameter_container,parameter_div_id){const parameters_div=parameter_container.querySelector("#"+parameter_div_id);parameters_div.style.display="grid";const inputs=parameters_div.querySelectorAll("input");for(const input of inputs)input.disabled=!1},displayMetricParameters=function(metricSelectId){const metric_select=document.getElementById(metricSelectId),metric_select_value=metric_select.value,parameter_container=metric_select.nextElementSibling;hideConversionParameters(parameter_container,"metric-parameters");switch(metric_select_value){case"GaussKernel":displayParametersElements(parameter_container,"gauss-parameters")}},displayAlgorithmParameters=function(algorithmSelectId,parameterDivSuffix){const algorithm_select=document.getElementById(algorithmSelectId),algorithm_parameter_id=algorithm_select.value.toLowerCase()+parameterDivSuffix,parameter_container=algorithm_select.nextElementSibling;hideConversionParameters(parameter_container,"algorithm-parameters");displayParametersElements(parameter_container,algorithm_parameter_id)},selectDropDownOption=function(dropDownId,optionValue){document.getElementById(dropDownId).querySelector(`option[value="${optionValue}"]`).setAttribute("selected","selected")},prepareInputForm=function(){addFileButtonsEventListeners();addCollapsibleEventListeners();displayMetricParameters("InputModel_MetricName");displayAlgorithmParameters("InputModel_ConversionAlgorithmName","-parameters");displayMetricParameters("append-metric");displayAlgorithmParameters("append-convert","-parameters-append");selectDropDownOption("InputModel_Directed",1);selectDropDownOption("InputModel_CommunityDetection",1);const mvn_input_section=document.getElementById("mvn-input-section");mvn_input_section.addEventListener("click",toggleNetworkInput);for(const form of mvn_input_section.querySelectorAll("form"))form.addEventListener("click",function(e){e.stopPropagation()});$("mvn-input-form").on("submit",function(e){e.preventDefault();const isValid=validateNewNetworkForm(this);return isValid&&$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:"/Home/LoadGraph",data:formData}),isValid});$("#mvn-append-form").submit(function(e){const current_graph_input=e.currentTarget.querySelector("#currentGraph");current_graph_input.value=JSON.stringify(store)})},isNullOrEmpty=function(string){return string===null||string===""},validateNewNetworkForm=function(form){let isValid=!0,errorMessage="";const vectorFile=form.querySelector("#fileVector").value;isNullOrEmpty(vectorFile)&&(errorMessage+="Please insert the vector file.<br>",isValid=!1);const separators=form.querySelector("#Separators").value;isNullOrEmpty(separators)&&(errorMessage+="Please enter the data separating character.<br>",isValid=!1);const missingValues=form.querySelector("#missingvalues").value;isNullOrEmpty(missingValues)&&(errorMessage+="Please enter the string which will represents missing values.<br>",isValid=!1);const errorParagraph=form.querySelector("#new-network-error-para");return errorParagraph.innerHTML=errorMessage,isValid},validateAppendNetworkForm=function(form){let isValid=!0,errorMessage="";graph.nodes.length<=0&&(errorMessage+="There is no graph to append to.<br>",isValid=!1);const vectorFile=form.querySelector("#fileVectorAppend").value;isNullOrEmpty(vectorFile)&&(errorMessage+="Please insert the vector file.<br>",isValid=!1);const separators=form.querySelector("#separatorsAppend").value;isNullOrEmpty(separators)&&(errorMessage+="Please enter the data separating character.<br>",isValid=!1);const missingValues=form.querySelector("#missingvaluesAppend").value;isNullOrEmpty(missingValues)&&(errorMessage+="Please enter the string which will represents missing values.<br>",isValid=!1);const errorParagraph=form.querySelector("#append-network-error-para");return errorParagraph.innerHTML=errorMessage,isValid},closeAllToolbarPanels=function(){$(".toolbar-panel.active-flex").removeClass("active-flex")},toggleToolPanel=function(e,toolPanelId){e.stopPropagation();closeAllToolbarPanels();$("#"+toolPanelId).toggleClass("active-flex")},openFileBrowser=function(inputId){document.getElementById(inputId).click()},isLower=function(value1,value2){return value1<value2},isGreater=function(value1,value2){return value1>value2};class FilterCondition{constructor(booleanFunction){this.booleanFunction=booleanFunction}}const lower=new FilterCondition(isLower),greater=new FilterCondition(isGreater),filterByValue=function(input,filteredAttributeName,filterCondition,minmax){let value=parseFloat(input.value);const extremeValue=parseFloat(minmax?input.max:input.min),filterSuffix=minmax?"_max":"_min",attributeFilterType=minmax?"high":"low";filterCondition.booleanFunction(value,extremeValue)&&(value=extremeValue,input.value=extremeValue);attributefilter[filteredAttributeName]||(attributefilter[filteredAttributeName]={});attributefilter[filteredAttributeName][attributeFilterType]=value;const{nodes:storeNodes,links:storeLinks}=store,{nodes:graphNodes,links:graphLinks}=graph;storeNodes.forEach(function(n){const{[filteredAttributeName]:filAttrVal}=n,nodeHeading=$("#heading-"+n.id);if(filAttrVal!=="")if(filterCondition.booleanFunction(filAttrVal,value)){if(!n.filters){n.filters=[];for(const[i,d]of graphNodes.entries())n.id===d.id&&graphNodes.splice(i,1);filterNodeList.push(n.id);nodeHeading.addClass("node-heading-disabled")}n.filters.includes(filteredAttributeName+filterSuffix)||n.filters.push(filteredAttributeName+filterSuffix)}else!filterCondition.booleanFunction(filAttrVal,value)&&n.filters&&n.filters.length>0&&n.filters.includes(filteredAttributeName+filterSuffix)&&(n.filters.splice(n.filters.indexOf(filteredAttributeName+filterSuffix),1),n.filters.length===0&&(graphNodes.push($.extend(!0,{},n)),filterNodeList.splice(filterNodeList.indexOf(n.id),1),delete n.filters,nodeHeading.removeClass("node-heading-disabled")))});storeLinks.forEach(function(l){const{source,target}=l;if(filterNodeList.includes(source)||filterNodeList.includes(target)||!l.filtered){if((filterNodeList.includes(source)||filterNodeList.includes(target))&&!l.filtered){l.filtered=!0;for(const[i,d]of graphLinks.entries())l.id===d.id&&graphLinks.splice(i,1)}}else l.filtered=!1,graphLinks.push($.extend(!0,{},l))});updateNodesAndLinks();resetSimulation()},filterByCategory=function(filteredAttributeName,category,checked){const{nodes:storeNodes,links:storeLinks}=store,{nodes:graphNodes,links:graphLinks}=graph;storeNodes.forEach(function(n){const{[filteredAttributeName]:filAttrVal}=n;filAttrVal!==""&&(checked||filAttrVal!==category?checked&&filAttrVal===category&&n.filters&&(delete attributefilter[filteredAttributeName],n.filters.length>0&&n.filters.includes(filteredAttributeName+"_"+category)&&(n.filters.splice(n.filters.indexOf(filteredAttributeName+"_"+category),1),n.filters.length===0&&(graphNodes.push($.extend(!0,{},n)),filterNodeList.splice(filterNodeList.indexOf(n.id),1),delete n.filters))):(attributefilter[filteredAttributeName]||(attributefilter[filteredAttributeName]={}),attributefilter[filteredAttributeName].cat=category,n.filters||(n.filters=[],graphNodes.forEach(function(d,i){n.id===d.id&&graphNodes.splice(i,1)}),filterNodeList.push(n.id)),n.filters.includes(filteredAttributeName+"_"+category)||n.filters.push(filteredAttributeName+"_"+category)))});storeLinks.forEach(function(l){const{source,target}=l;filterNodeList.includes(source)||filterNodeList.includes(target)||!l.filtered?(filterNodeList.includes(source)||filterNodeList.includes(target))&&!l.filtered&&(l.filtered=!0,graphLinks.forEach(function(d,i){l.id===d.id&&graph.links.splice(i,1)})):(l.filtered=!1,graphLinks.push($.extend(!0,{},l)))});updateNodesAndLinks();resetSimulation()},handleForceEnablement=function(value,force,forceUpdateDelegate){currentGraph.setForcePropertyValue(force,"enabled",value);forceUpdateDelegate();currentGraph.resetSimulation()},handleForceChange=function(value,sliderOutputId,force,property,forceUpdateDelegate){d3.select("#"+sliderOutputId).text(value);currentGraph.setForcePropertyValue(force,property,Number(value));forceUpdateDelegate();currentGraph.resetSimulation()},getNodeAttribute=function(d,attributeName){return currentGraph.getNodeDataValue(d.id,attributeName)},getNodeProperty=function(d,attributeName){return currentGraph.getPropertyValue(d.id,attributeName)},enableNodeLabels=function(){nodeText.classed("invisible",!nodeVisualProperties.labels.enabled)},setNodeLabel=function(selectElement){const attributeName=selectElement.value,optgroup=selectElement.options[selectElement.selectedIndex].closest("optgroup");if(nodeVisualProperties.labels.attribute=attributeName,attributeName===""){nodeText.style("display","none");return}nodeText.style("display","block");let getValueFunction=getNodeAttribute;if(attributeName==="id"){nodeText.text(function(d){return d.id});return}if(optgroup!==null){const optGroupLabel=optgroup.getAttribute("label");optGroupLabel==="Centralities"&&(getValueFunction=getNodeProperty)}nodeText.text(function(d){return getValueFunction(d,attributeName)})},setAttributeNodeSizing=function(selectElement){const attributeName=selectElement.value,defaultRadius=currentGraph.getForcePropertyValue(Graph.forceNames.collide,"radius");if(nodeVisualProperties.sizing.attribute=attributeName,attributeName!==""){nodeVisualProperties.sizing.enabled=!0;const optgroup=selectElement.options[selectElement.selectedIndex].closest("optgroup").getAttribute("label");let attributeMax=null,attributeMin=null,getValueFunction=null;optgroup==="Attributes"?(attributeMax=parseFloat($("#"+attributeName+"-sliderOutputMin").attr("max")),attributeMin=parseFloat($("#"+attributeName+"-sliderOutputMin").attr("min")),getValueFunction=getNodeAttribute):optgroup==="Centralities"&&(attributeMax=currentGraph.getPropertyAttributeValue(attributeName,"max"),attributeMin=currentGraph.getPropertyAttributeValue(attributeName,"min"),getValueFunction=getNodeProperty);node.attr("r",function(d){const attributeValue=getValueFunction(d,attributeName);if(attributeValue=="")return d.r=defaultRadius/2;const resultRadius=defaultRadius*2*((parseFloat(attributeValue)-attributeMin)/(attributeMax-attributeMin))+1;return d.r=resultRadius});setNodeFontSize();return}nodeVisualProperties.sizing.enabled=!1;node.attr("r",function(d){return d.r=defaultRadius});setNodeFontSize()},rgbObjectToString=function(rgbObject){return"rgb("+rgbObject.r+", "+rgbObject.g+", "+rgbObject.b+")"},pickHex=function(color1,color2,weight){const w2=weight,w1=1-w2;return{r:Math.round(color1.r*w1+color2.r*w2),g:Math.round(color1.g*w1+color2.g*w2),b:Math.round(color1.b*w1+color2.b*w2)}},changeAttributeGradientColouringFromSettings=function(attributeSelectId,lowColourId,highColourId){const attributeSelect=document.getElementById(attributeSelectId),optgroup=attributeSelect.options[attributeSelect.selectedIndex].closest("optgroup").getAttribute("label"),attributeName=attributeSelect.value,lowColour=document.getElementById(lowColourId).value,highColour=document.getElementById(highColourId).value;setAttributeGradientColouring(attributeName,optgroup,lowColour,highColour)},addListColour=function(value,idPrefix,colourList){const valueWithoutWhitespaces=removeSpacesAndCommas(value),id=`${idPrefix}-colour-${valueWithoutWhitespaces}`,newDistinctColourRow=colourList.append("li").append("div").classed("colour-row-list",!0);newDistinctColourRow.append("label").attr("for",id).html(value);newDistinctColourRow.append("input").attr("type","color").attr("id",id).property("value",groupColours(value))},saveAttributeGradientColouring=function(attributeSelectId,lowColourId,highColourId){const attributeSelect=document.getElementById(attributeSelectId),optgroup=attributeSelect.options[attributeSelect.selectedIndex].closest("optgroup").getAttribute("label"),attributeName=attributeSelect.value,lowColour=document.getElementById(lowColourId),highColour=document.getElementById(highColourId)},setAttributeGradientColouring=function(attributeName,optgroup,lowColour,highColour){const attributeColouringProperty=nodeVisualProperties.attributeColouring;attributeColouringProperty.attribute=attributeName;attributeColouringProperty.lowValue=lowColour;attributeColouringProperty.highValue=highColour;const lowValueColourRGB=hexToRgb(lowColour),highValueColourRGB=hexToRgb(highColour);attributeColouringProperty.enabled=!0;let attributeMax=null,attributeMin=null,getValueFunction=null;optgroup==="Numeric Attributes"?(attributeMax=parseFloat($("#"+attributeName+"-sliderOutputMin").attr("max")),attributeMin=parseFloat($("#"+attributeName+"-sliderOutputMin").attr("min")),getValueFunction=getNodeAttribute):(attributeMax=currentGraph.getPropertyAttributeValue(attributeName,"max"),attributeMin=currentGraph.getPropertyAttributeValue(attributeName,"min"),getValueFunction=getNodeProperty);node.style("fill",function(d){const attributeValue=getValueFunction(d,attributeName);if(attributeValue==="")return nodeVisualProperties.colouring.network;const resultValue=(parseFloat(attributeValue)-attributeMin)/(attributeMax-attributeMin),resultColour=pickHex(lowValueColourRGB,highValueColourRGB,resultValue),lightness=fontLightness(resultColour),node_text=$("#"+d.id+"_node_text");return node_text.css("fill","hsl(0, 0%, "+String(lightness)+"%)"),rgbObjectToString(resultColour)});link.style("stroke",nodeVisualProperties.colouring.network)},changeAttributeCategoryColouringList=function(attributeSelectId,colourListId){const attributeName=document.getElementById(attributeSelectId).value,colourList=d3.select(`#${colourListId}`),attributeDistinctValues=currentGraph.getDistinctValues(attributeName);colourList.html("");for(const value of attributeDistinctValues)addListColour(value,"category",colourList)},changeAttributeCategoryColouringFromSettings=function(attributeSelectId,colourListId){const attributeName=document.getElementById(attributeSelectId).value,colourList=document.getElementById(colourListId),colourObject={};for(const colourLI of colourList.children){const distinctValue=colourLI.querySelector("label").innerHTML,colour=colourLI.querySelector("input").value;colourObject[distinctValue]=colour}setAttributeCategoryColouring(attributeName,colourObject)},saveAttributeCategoryColouring=function(){},setAttributeCategoryColouring=function(attributeName,colourObject){node.style("fill",function(d){const attributeValue=getNodeAttribute(d,attributeName);if(attributeValue==="")return nodeVisualProperties.colouring.network;const resultColour=hexToRgb(colourObject[attributeValue]),lightness=fontLightness(resultColour),node_text=$("#"+d.id+"_node_text");return node_text.css("fill","hsl(0, 0%, "+String(lightness)+"%)"),rgbObjectToString(resultColour)});link.style("stroke",nodeVisualProperties.colouring.network)},setPartitionColouring=function(colourListId){const colourList=document.getElementById(`${colourListId}`),colourObject={};for(const colourLI of colourList.children){const distinctPartition=colourLI.querySelector("label").innerHTML,colour=colourLI.querySelector("input").value;colourObject[distinctPartition]=colour}node.style("fill",function(d){const{id}=d,partition=currentGraph.getPartition(id);if(partition==="")return nodeVisualProperties.colouring.network;const resultColour=hexToRgb(colourObject[partition]),lightness=fontLightness(resultColour),node_text=$("#"+id+"_node_text");return node_text.css("fill","hsl(0, 0%, "+String(lightness)+"%)"),rgbObjectToString(resultColour)});link.style("stroke",function(l){const{id}=l.source,partition=currentGraph.getPartition(id);return partition===""?nodeVisualProperties.colouring.network:colourObject[partition]})},projectAttributeXAxis=function(selectElement){const attributeName=selectElement.value;if(attributeName!==""){const optgroup=selectElement.options[selectElement.selectedIndex].closest("optgroup").getAttribute("label");let attributeMax=null,attributeMin=null;optgroup==="Attributes"?(attributeMax=parseFloat($("#"+attributeName+"-sliderOutputMin").attr("max")),attributeMin=parseFloat($("#"+attributeName+"-sliderOutputMin").attr("min")),currentGraph.updateXForceAttribute(attributeName,attributeMax,attributeMin)):optgroup==="Centralities"&&(attributeMax=graph.properties[attributeName].max,attributeMin=graph.properties[attributeName].min,currentGraph.updateXForceProperty(attributeName));currentGraph.toggleXForce(!0);currentGraph.resetSimulation();return}currentGraph.toggleXForce(!1);currentGraph.resetSimulation()},projectAttributeYAxis=function(selectElement){const attributeName=selectElement.value;if(attributeName!==""){const optgroup=selectElement.options[selectElement.selectedIndex].closest("optgroup").getAttribute("label");let attributeMax=null,attributeMin=null;optgroup==="Attributes"?(attributeMax=parseFloat($("#"+attributeName+"-sliderOutputMin").attr("max")),attributeMin=parseFloat($("#"+attributeName+"-sliderOutputMin").attr("min")),currentGraph.updateYForceAttribute(attributeName,attributeMax,attributeMin)):optgroup==="Centralities"&&(attributeMax=graph.properties[attributeName].max,attributeMin=graph.properties[attributeName].min,currentGraph.updateYForceProperty(attributeName));currentGraph.toggleYForce(!0);currentGraph.resetSimulation();return}currentGraph.toggleYForce(!1);currentGraph.resetSimulation()},createDoubleSlider=function(sliderId,attributeName,minValueId,maxValueId,minValue,maxValue,lowValue=minValue,highValue=maxValue){$("#"+sliderId).slider({range:!0,min:minValue,max:maxValue,values:[lowValue,highValue],step:.01,stop:function(event,ui){const minValueElem=document.getElementById(minValueId),maxValueElem=document.getElementById(maxValueId);minValueElem.value=ui.values[0];maxValueElem.value=ui.values[1];ui.handleIndex===0?filterByValue(minValueElem,attributeName,lower,!1):ui.handleIndex===1&&filterByValue(maxValueElem,attributeName,greater,!0)}})},changeNetworkNodeColour=function(colourInputId){const colour=$(`#${colourInputId}`).val();nodeVisualProperties.colouring.network=colour;updateNodeAndLinkColour(node,link)},changeNetworkBackgroundColour=function(colourInputId){const colour=$(`#${colourInputId}`).val();nodeVisualProperties.colouring.background=colour;$("#network-background-rect.background").css("fill",colour)},shortestPathsBFS=function(graph){const paths={},visited={},{nodes,nodes:{length},linkedByIndex}=graph;for(const node1 of nodes){const node1Id=node1.id;paths[node1Id]={};visited[node1Id]={};for(const node2 of graph.nodes){const node2Id=node2.id;paths[node1Id][node2Id]=Infinity;visited[node1Id][node2Id]=!1}}for(const[i,node]of nodes.entries()){const src=node.id;paths[src][src]=0;visited[src][src]=!0;const q=new Queue;for(q.enqueue(src);!q.isEmpty;){const u=q.dequeue();for(let j=i;j<length;j++){const v=nodes[j].id;(visited[src][v]===!1&&linkedByIndex[u+","+v]||linkedByIndex[v+","+u]||u===v)&&(visited[src][v]=!0,paths[src][v]=paths[v][src]=paths[src][u]+1,q.enqueue(v))}}}return paths},openTab=function(event,contentId,divId,contentClass){const hello=document.getElementById(divId),tabcontents=document.getElementById(divId).querySelectorAll(contentClass);for(const tabcontent of tabcontents)tabcontent.style.display="none";const tablinks=document.getElementById(divId).querySelectorAll(".tab-link");for(const tablink of tablinks)tablink.className=tablink.className.replace(" tab-active","");document.getElementById(contentId).style.display="block";event.currentTarget.className+=" tab-active"},getJsonValue=function(obj,stringPath){return stringPath.split(".").reduce(function(o,k){return o&&o[k]},obj)},cancelDefaultBehaviour=function(e){return e.preventDefault(),e.stopPropagation(),!1},removeSpacesAndCommas=function(inputString){return inputString.replace(/[\s,]+/g,"-")};window.addEventListener("load",function(){$(".collapse.in").prev(".panel-heading").addClass("active");$("#accordion").on("show.bs.collapse",function(a){$(a.target).prev(".panel-heading").addClass("active")}).on("hide.bs.collapse",function(a){$(a.target).prev(".panel-heading").removeClass("active")});document.addEventListener("click",closeAllToolbarPanels);prepareInputForm();calculateAllMetrics();prepareNodeDatalist();selectionNode.each(function(d){setGroupColour(d)});const{num:numAttributes=[]}=currentGraph.attributes;for(const attribute of numAttributes){const containerDivId=attribute+"-histogram-container";hist(containerDivId,currentGraph,attribute)}changeAttributeCategoryColouringList("categorical-attribute-node-colouring","categorical-colour-list");updateRemodelOptionsHeader("remodel-attribute-panel-header","remodel-network-select");displayAlgorithmParameters("remodel-algorithm-select","-parameters-remodel");displayMetricParameters("remodel-metric-select")}),function(global,factory){typeof exports=="object"&&typeof module!="undefined"?factory(exports,require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-selection"),require("d3-transition")):typeof define=="function"&&define.amd?define(["exports","d3-dispatch","d3-drag","d3-interpolate","d3-selection","d3-transition"],factory):factory(global.d3=global.d3||{},global.d3,global.d3,global.d3,global.d3,global.d3)}(this,function(exports,d3Dispatch,d3Drag,d3Interpolate,d3Selection,d3Transition){"use strict";function nopropagation(){d3Selection.event.stopImmediatePropagation()}function type(t){return{type:t}}function defaultFilter(){return!d3Selection.event.button}function defaultExtent(){var svg=this.ownerSVGElement||this;return[[0,0],[svg.width.baseVal.value,svg.height.baseVal.value]]}function local(node){while(!node.__brush)if(!(node=node.parentNode))return;return node.__brush}function empty(extent){return extent[0][0]===extent[1][0]||extent[0][1]===extent[1][1]}function brushSelection(node){var state=node.__brush;return state?state.dim.output(state.selection):null}function brushX(){return brush$1(X)}function brushY(){return brush$1(Y)}function brush$1(dim){function brush(group){var overlay=group.property("__brush",initialize).selectAll(".overlay").data([type("overlay")]),handle;overlay.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",cursors.overlay).merge(overlay).each(function(){var extent=local(this).extent;d3Selection.select(this).attr("x",extent[0][0]).attr("y",extent[0][1]).attr("width",extent[1][0]-extent[0][0]).attr("height",extent[1][1]-extent[0][1])});group.selectAll(".selection").data([type("selection")]).enter().append("rect").attr("class","selection").attr("cursor",cursors.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");handle=group.selectAll(".handle").data(dim.handles,function(d){return d.type});handle.exit().remove();handle.enter().append("rect").attr("class",function(d){return"handle handle--"+d.type}).attr("cursor",function(d){return cursors[d.type]});group.each(redraw).attr("fill","none").attr("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush touchstart.brush",started)}function redraw(){var group=d3Selection.select(this),selection=local(this).selection;selection?(group.selectAll(".selection").style("display",null).attr("x",selection[0][0]).attr("y",selection[0][1]).attr("width",selection[1][0]-selection[0][0]).attr("height",selection[1][1]-selection[0][1]),group.selectAll(".handle").style("display",null).attr("x",function(d){return d.type[d.type.length-1]==="e"?selection[1][0]-handleSize/2:selection[0][0]-handleSize/2}).attr("y",function(d){return d.type[0]==="s"?selection[1][1]-handleSize/2:selection[0][1]-handleSize/2}).attr("width",function(d){return d.type==="n"||d.type==="s"?selection[1][0]-selection[0][0]+handleSize:handleSize}).attr("height",function(d){return d.type==="e"||d.type==="w"?selection[1][1]-selection[0][1]+handleSize:handleSize})):group.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function emitter(that,args){return that.__brush.emitter||new Emitter(that,args)}function Emitter(that,args){this.that=that;this.args=args;this.state=that.__brush;this.active=0}function started(){function moved(){var point1=d3Selection.mouse(that);point=point1;moving=!0;noevent();move()}function move(){var t;dx=point[0]-point0[0];dy=point[1]-point0[1];switch(mode){case MODE_SPACE:case MODE_DRAG:signX&&(dx=Math.max(W-w0,Math.min(E-e0,dx)),w1=w0+dx,e1=e0+dx);signY&&(dy=Math.max(N-n0,Math.min(S-s0,dy)),n1=n0+dy,s1=s0+dy);break;case MODE_HANDLE:signX<0?(dx=Math.max(W-w0,Math.min(E-w0,dx)),w1=w0+dx,e1=e0):signX>0&&(dx=Math.max(W-e0,Math.min(E-e0,dx)),w1=w0,e1=e0+dx);signY<0?(dy=Math.max(N-n0,Math.min(S-n0,dy)),n1=n0+dy,s1=s0):signY>0&&(dy=Math.max(N-s0,Math.min(S-s0,dy)),n1=n0,s1=s0+dy);break;case MODE_CENTER:signX&&(w1=Math.max(W,Math.min(E,w0-dx*signX)),e1=Math.max(W,Math.min(E,e0+dx*signX)));signY&&(n1=Math.max(N,Math.min(S,n0-dy*signY)),s1=Math.max(N,Math.min(S,s0+dy*signY)))}e1<w1&&(signX*=-1,t=w0,w0=e0,e0=t,t=w1,w1=e1,e1=t,type in flipX&&overlay.attr("cursor",cursors[type=flipX[type]]));s1<n1&&(signY*=-1,t=n0,n0=s0,s0=t,t=n1,n1=s1,s1=t,type in flipY&&overlay.attr("cursor",cursors[type=flipY[type]]));state.selection&&(selection=state.selection);lockX&&(w1=selection[0][0],e1=selection[1][0]);lockY&&(n1=selection[0][1],s1=selection[1][1]);(selection[0][0]!==w1||selection[0][1]!==n1||selection[1][0]!==e1||selection[1][1]!==s1)&&(state.selection=[[w1,n1],[e1,s1]],redraw.call(that),emit.brush())}function ended(){if(nopropagation(),d3Selection.event.touches){if(d3Selection.event.touches.length)return;touchending&&clearTimeout(touchending);touchending=setTimeout(function(){touchending=null},500);group.on("touchmove.brush touchend.brush touchcancel.brush",null)}else{d3Drag.dragEnable(d3Selection.event.view,moving);view.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null)}group.attr("pointer-events","all");overlay.attr("cursor",cursors.overlay);state.selection&&(selection=state.selection);empty(selection)&&(state.selection=null,redraw.call(that));emit.end()}function keydowned(){switch(d3Selection.event.keyCode){case 18:mode===MODE_HANDLE&&(signX&&(e0=e1-dx*signX,w0=w1+dx*signX),signY&&(s0=s1-dy*signY,n0=n1+dy*signY),mode=MODE_CENTER,move());break;case 32:(mode===MODE_HANDLE||mode===MODE_CENTER)&&(signX<0?e0=e1-dx:signX>0&&(w0=w1-dx),signY<0?s0=s1-dy:signY>0&&(n0=n1-dy),mode=MODE_SPACE,overlay.attr("cursor",cursors.selection),move());break;default:return}noevent()}function keyupped(){switch(d3Selection.event.keyCode){case 18:mode===MODE_CENTER&&(signX<0?e0=e1:signX>0&&(w0=w1),signY<0?s0=s1:signY>0&&(n0=n1),mode=MODE_HANDLE,move());break;case 32:mode===MODE_SPACE&&(d3Selection.event.altKey?(signX&&(e0=e1-dx*signX,w0=w1+dx*signX),signY&&(s0=s1-dy*signY,n0=n1+dy*signY),mode=MODE_CENTER):(signX<0?e0=e1:signX>0&&(w0=w1),signY<0?s0=s1:signY>0&&(n0=n1),mode=MODE_HANDLE),overlay.attr("cursor",cursors[type]),move());break;default:return}noevent()}var group,overlay,view;if(d3Selection.event.touches){if(d3Selection.event.changedTouches.length<d3Selection.event.touches.length)return noevent()}else if(touchending)return;if(filter.apply(this,arguments)){var that=this,type=d3Selection.event.target.__data__.type,mode=(d3Selection.event.metaKey?type="overlay":type)==="selection"?MODE_DRAG:d3Selection.event.altKey?MODE_CENTER:MODE_HANDLE,signX=dim===Y?null:signsX[type],signY=dim===X?null:signsY[type],state=local(that),extent=state.extent,selection=state.selection,W=extent[0][0],w0,w1,N=extent[0][1],n0,n1,E=extent[1][0],e0,e1,S=extent[1][1],s0,s1,dx,dy,moving,lockX,lockY,point0=d3Selection.mouse(that),point=point0,emit=emitter(that,arguments).beforestart();if(type==="overlay"?state.selection=selection=[[w0=dim===Y?W:point0[0],n0=dim===X?N:point0[1]],[e0=dim===Y?E:w0,s0=dim===X?S:n0]]:(w0=selection[0][0],n0=selection[0][1],e0=selection[1][0],s0=selection[1][1]),w1=w0,n1=n0,e1=e0,s1=s0,group=d3Selection.select(that).attr("pointer-events","none"),overlay=group.selectAll(".overlay").attr("cursor",cursors[type]),d3Selection.event.touches)group.on("touchmove.brush",moved,!0).on("touchend.brush touchcancel.brush",ended,!0);else view=d3Selection.select(d3Selection.event.view).on("keydown.brush",keydowned,!0).on("keyup.brush",keyupped,!0).on("mousemove.brush",moved,!0).on("mouseup.brush",ended,!0),d3Drag.dragDisable(d3Selection.event.view);nopropagation();d3Transition.interrupt(that);redraw.call(that);emit.start()}}function initialize(){var state=this.__brush||{selection:null};return state.extent=extent.apply(this,arguments),state.dim=dim,state}var extent=defaultExtent,filter=defaultFilter,listeners=d3Dispatch.dispatch(brush,"start","brush","end"),handleSize=6,touchending;return brush.move=function(group,selection){group.selection?group.on("start.brush",function(){emitter(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){emitter(this,arguments).end()}).tween("brush",function(){function tween(t){state.selection=t===1&&empty(selection1)?null:i(t);redraw.call(that);emit.brush()}var that=this,state=that.__brush,emit=emitter(that,arguments),selection0=state.selection,selection1=dim.input(typeof selection=="function"?selection.apply(this,arguments):selection,state.extent),i=d3Interpolate.interpolate(selection0,selection1);return selection0&&selection1?tween:tween(1)}):group.each(function(){var that=this,args=arguments,state=that.__brush,selection1=dim.input(typeof selection=="function"?selection.apply(that,args):selection,state.extent),emit=emitter(that,args).beforestart();d3Transition.interrupt(that);state.selection=selection1==null||empty(selection1)?null:selection1;redraw.call(that);emit.start().brush().end()})},Emitter.prototype={beforestart:function(){return++this.active==1&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting&&(this.starting=!1,this.emit("start")),this},brush:function(){return this.emit("brush"),this},end:function(){return--this.active==0&&(delete this.state.emitter,this.emit("end")),this},emit:function(type){d3Selection.customEvent(new BrushEvent(brush,type,dim.output(this.state.selection)),listeners.apply,listeners,[type,this.that,this.args])}},brush.extent=function(_){return arguments.length?(extent=typeof _=="function"?_:constant([[+_[0][0],+_[0][1]],[+_[1][0],+_[1][1]]]),brush):extent},brush.filter=function(_){return arguments.length?(filter=typeof _=="function"?_:constant(!!_),brush):filter},brush.handleSize=function(_){return arguments.length?(handleSize=+_,brush):handleSize},brush.on=function(){var value=listeners.on.apply(listeners,arguments);return value===listeners?brush:value},brush}var constant=function(x){return function(){return x}},BrushEvent=function(target,type,selection){this.target=target;this.type=type;this.selection=selection},noevent=function(){d3Selection.event.preventDefault();d3Selection.event.stopImmediatePropagation()},MODE_DRAG={name:"drag"},MODE_SPACE={name:"space"},MODE_HANDLE={name:"handle"},MODE_CENTER={name:"center"},X={name:"x",handles:["e","w"].map(type),input:function(x,e){return x&&[[x[0],e[0][1]],[x[1],e[1][1]]]},output:function(xy){return xy&&[xy[0][0],xy[1][0]]}},Y={name:"y",handles:["n","s"].map(type),input:function(y,e){return y&&[[e[0][0],y[0]],[e[1][0],y[1]]]},output:function(xy){return xy&&[xy[0][1],xy[1][1]]}},XY={name:"xy",handles:["n","e","s","w","nw","ne","se","sw"].map(type),input:function(xy){return xy},output:function(xy){return xy}},cursors={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},flipX={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},flipY={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},signsX={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},signsY={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1},brush=function(){return brush$1(XY)};exports.brush=brush;exports.brushX=brushX;exports.brushY=brushY;exports.brushSelection=brushSelection;Object.defineProperty(exports,"__esModule",{value:!0})});const saveGraph=function(fileName){var a=document.createElement("a"),file;const stateJson=serializeGraph();file=new Blob([JSON.stringify(stateJson,null,2)],{type:"application/json"});a.href=URL.createObjectURL(file);a.download=fileName;a.click()},serializeGraph=function(){const stateJson={};stateJson.store=store;const savedGraph=structuredClone(graph),{links}=savedGraph;for(let i=0;i<links.length;i++)links[i].source=links[i].source.id,links[i].target=links[i].target.id;stateJson.graph=savedGraph;const savedSelectionGraph=structuredClone(selectionGraph),{links:selectionLinks}=savedSelectionGraph;for(let i=0;i<selectionLinks.length;i++)selectionLinks[i].source=selectionLinks[i].source.id,selectionLinks[i].target=selectionLinks[i].target.id;stateJson.selectionGraph=savedSelectionGraph;stateJson.forceProperties=forceProperties;const filters=serializeFilters();return stateJson.filters=filters,stateJson.filterNodeList=filterNodeList,stateJson},serializeNumericFilters=function(filterDiv){const numericFilters=filterDiv.getElementsByClassName("numeric"),resultFilters=[];for(const numericFilter of numericFilters){const attributeName=numericFilter.querySelector("h4").innerHTML,minInput=numericFilter.querySelector("#"+attributeName+"-sliderOutputMin"),maxInput=numericFilter.querySelector("#"+attributeName+"-sliderOutputMax"),filterJson={attribute:attributeName,min:parseFloat(minInput.min),max:parseFloat(maxInput.max),lowValue:parseFloat(minInput.value),highValue:parseFloat(maxInput.value)};resultFilters.push(filterJson)}return parseFloat(),resultFilters},serializeCategoricalFilters=function(filterDiv){const categoricalFilters=filterDiv.getElementsByClassName("categorical"),resultFilters=[];for(const categoricalFilter of categoricalFilters){const attributeName=categoricalFilter.querySelector("h4").innerHTML,checkboxes=categoricalFilter.querySelectorAll("input"),filterJson={attribute:attributeName,categories:{}};for(const checkbox of checkboxes){const category=checkbox.value,checked=checkbox.checked;filterJson.categories[category]=checked}resultFilters.push(filterJson)}return resultFilters},serializeFilters=function(){const filterDiv=document.getElementById("attributes");return{numeric:serializeNumericFilters(filterDiv),categorical:serializeCategoricalFilters(filterDiv)}},loadNetwork=async function(fileName){var reader=new FileReader;reader.onload=function(e){deleteGraphElementsAndControls();updateSelectionNodesAndLinks();var json=JSON.parse(e.target.result);forceProperties=json.forceProperties;filters=json.filters;filterNodeList=json.filterNodeList;graph=json.graph;store=json.store;selectionGraph=json.selectionGraph;drawSelectionNetwork(selectionGraph);selectionGraph.nodes.forEach(function(d){addSelectionDiv(d)});generateGraphControlAndElements(store,forceProperties,filters);gDraw.html("");drawNetwork(graph);updateForces(!1);simulationEnd();calculateAllMetrics();forceProperties.attributeColouring.enabled||updateNodeAndLinkColour(node,link);updateHeadingColour(graph.nodes)};reader.readAsText(fileName)},prepareNodeDatalist=function(){const nodeInput=document.getElementById("node-list-input"),nodeDataList=document.getElementById("node-list");nodeInput.addEventListener("focus",showNodeDataList);nodeInput.addEventListener("keyup",filterNodeSearchList);nodeInput.addEventListener("blur",function(){nodeDataList.classList.remove("active-block")});nodeInput.addEventListener("mousedown",function(){document.activeElement===nodeInput&&nodeInput.blur()})},showNodeDataList=function(){const nodeDataList=document.getElementById("node-list");nodeDataList.classList.add("active-block")},filterNodeSearchList=function(){const nodeInput=document.getElementById("node-list-input"),filterValue=nodeInput.value.toLowerCase(),nodeList=document.getElementById("node-list"),nodeListItems=nodeList.getElementsByTagName("*");for(const nodeListItem of nodeListItems){const nodeId=nodeListItem.textContent;if(nodeId.startsWith(filterValue)){nodeListItem.style.display="";continue}nodeListItem.style.display="none"}},nodeHeadingClick=function(event,nodeId,nodeIndex){selectNode(event,nodeId);toggleNodeDetails(nodeId,nodeIndex);showNodeNeighbors(nodeId)},nodeHeadingMouseOver=function(nodeId,opacity){fadeDisconnectedNodes(nodeId,opacity)},selectNode=function(event,nodeId){event.shiftKey||deselectAllNodes();nodeGroups.classed("selected",function(d){return d.selected=d.selected|d.id==nodeId})},toggleNodeDetails=function(nodeId,nodeIndex){const nodeInput=document.getElementById("node-list-input");nodeInput.value=nodeId;const detailsElement=document.getElementById("node-detail-container"),attributesDiv=document.getElementById("node-attributes"),centralitiesDiv=document.getElementById("node-centralities");detailsElement.setAttribute("data-id",nodeId);(detailsElement.style.display==="none"||detailsElement.style.display==="")&&(detailsElement.style.display="block");let inputs=attributesDiv.getElementsByTagName("input");for(const input of inputs){const attributeName=input.getAttribute("data-attribute");input.value=currentGraph.getNodeDataValue(nodeId,attributeName)}showNodeValueInHistogram(nodeId,nodeIndex,attributesDiv);inputs=centralitiesDiv.getElementsByTagName("input");for(const input of inputs){const attributeName=input.getAttribute("data-attribute"),attributeValue=currentGraph.getPropertyValue(nodeId,attributeName);input.value=attributeValue!==undefined?attributeValue:"Calculating"}},showNodeValueInHistogram=function(nodeId,nodeIndex,attributeDiv){const histogramSvgs=attributeDiv.getElementsByTagName("svg");for(const histogram of histogramSvgs){const attributeName=histogram.getAttribute("data-attribute"),attributeValue=currentGraph.getNodeDataValue(nodeId,attributeName),bins=histogram.getElementsByTagName("rect");d3.selectAll(bins).style("fill","#ffeead");for(const bin of bins)if(bin.getAttribute("data-max-value")>attributeValue){bin.style.fill="red";break}}},showNodeNeighbors=function(nodeId){const neighborsContainer=document.getElementById("node-neighbors-section"),neighborsHeadlineElement=neighborsContainer.firstElementChild;neighborsHeadlineElement.innerHTML='Node "'+nodeId+'" neighbors';createNeighborHeadings(nodeId)},createNeighborHeadings=function(nodeId){const neighborsGridElement=d3.select("#neighbors-nav");neighborsGridElement.html("");for(const link of currentGraph.links){let neighbor=null;if(link.source.id===nodeId&&(neighbor=link.target),link.target.id===nodeId&&(neighbor=link.source),neighbor!=null){const{id:neighborId,index:neighborIndex}=neighbor;createNeighborHeading(neighborsGridElement,neighborId,neighborIndex)}}},createNeighborHeading=function(neighborsGridElement,neighborId,neighborIndex){neighborsGridElement.append("div").classed("node-heading",!0).attr("role","tab").attr("id","neighbor-heading-"+neighborId).on("mouseout",function(){}).on("click",function(){nodeHeadingClick(event,neighborId,neighborIndex)}).on("mouseover",function(){}).append("h5").html(neighborId)};class Queue{constructor(){this.data={};this.head=0;this.tail=0}enqueue(element){this.data[this.tail]=element;this.tail++}dequeue(){const element=this.data[this.head];return delete this.data[this.head],this.head++,element}peek(){return this.data[this.head]}get length(){return this.tail-this.head}get isEmpty(){return this.length===0}}const inputColorClick=function(selection_panel){selection_panel.querySelector("input").click()},stopClickPropagation=function(event){event.stopPropagation()},selectNodesBySelection=function(selectionId,graphRef){deselectAllNodes();nodeGroups.filter(function(n){return graphRef.getPartition(n.id)===selectionId}).classed("selected",function(d){return d.previouslySelected=d.selected,d.selected=!0})},changeGroupColour=function(input,selectionId,graphRef){const selectionPanel=input.parentNode,newBackgroundColour=input.value;selectionPanel.style.backgroundColor=newBackgroundColour;const selectionNodes=node.filter(function(n){return graphRef.getPartition(n.id)===selectionId});selectionNodes.style("fill",function(d){return link.filter(function(l){return l.source===d.id||l.source.id===d.id}).style("stroke",newBackgroundColour),newBackgroundColour})},setGroupColour=function(d){document.getElementById("selection_color_"+d.id).value=groupColours(d.id)},getGroupColour=function(d){return document.getElementById("selection_color_"+d.id).value},addNewSelection=function(newId=null,mccObject){const{length,[length-1]:lastNode}=selectionGraph.nodes;newId===null&&(newId=length===0?0:lastNode.id+1);const newSelection={};newSelection.id=newId;newSelection.name="Selection "+newId;newSelection.nonodes=0;selectionGraph.nodes.push(newSelection);for(const node of selectionGraph.nodes){const newLink={};newLink.source=newId;newLink.target=node.id;newLink.value=0;const newLink2={};newLink2.source=node.id;newLink2.target=newId;newLink2.value=0;selectionGraph.links.push(newLink);newId!=node.id&&selectionGraph.links.push(newLink2)}addSelectionDiv(newSelection,mccObject)},addSelectionDiv=function(selectionId,mccObject){const mainDiv=d3.select("#list-selections"),panel=mainDiv.append("div").classed("selection-panel",!0).attr("id",`selection_panel_${selectionId}`).attr("onclick",`selectNodesBySelection(${selectionId}, ${currentGraph})`);panel.append("h4").attr("class","panel-title").attr("contenteditable","true").attr("onclick","stopClickPropagation(event)").html(`Selection ${selectionId}`);panel.style("background-color",groupColours(selectionId));const panel_list_add_btn=panel.append("button").attr("class","btn btn-danger btn-sm rounded-0").attr("type","button").attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Add Selected Nodes To This Group").attr("onclick",`addNodesToSelection(event, ${selectionId})`);panel_list_add_btn.append("i").attr("class","fa fa-plus-square");const panel_list_delete_btn=panel.append("button").attr("class","btn btn-danger btn-sm rounded-0").attr("type","button").attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Delete").attr("onclick",`deleteSelection(event, ${selectionId})`);panel_list_delete_btn.append("i").attr("class","fa fa-trash");const mccDiv=mainDiv.append("div").attr("class","col-2-table");for(const mccPair of mccObject[selectionId]){const{className,value}=mccPair;mccDiv.append("span").text(className+": "+value.toFixed(2)).style("border","0.1rem solid white")}const barplotID=`barplot-mcc-${selectionId}`;mainDiv.append("div").attr("id",barplotID).style("position","relative");barplot(barplotID,mccObject[selectionId],-1,1,selectionId)},hexToRgb=function(hex){hex=hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(m,r,g,b){return r+r+g+g+b+b});const result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null},fontLightness=function(newColour){let rgbRepresentation=newColour;typeof newColour!="object"&&(rgbRepresentation=hexToRgb(newColour));const{r,g,b}=rgbRepresentation,lumaRed=r*.2126,lumaGreen=g*.7152,lumaBlue=b*.0722,lumaSum=lumaRed+lumaGreen+lumaBlue,perceivedLightness=lumaSum/255;return(perceivedLightness-.5)*-1e7},addNodesToSelection=function(event,selectionId){stopClickPropagation(event);const newColour=document.getElementById("selection_color_"+selectionId).value,lightness=fontLightness(newColour);node.filter(function(d){return d.selected}).each(function(d){let previousGroup=null;const{id:nodeId}=d,{[nodeId]:partition}=graph.partitions;if(partition!=""){previousGroup=partition;link.filter(function(l){return l.source.id==nodeId||l.target.id==nodeId}).each(function(l){const{source:{id:sourceId},target:{id:targetId},value}=l,{[sourceId]:node1Partition,[targetId]:node2Partition}=graph.partitions;if(node1Partition!=""&&node2Partition!="")if(sourceId==nodeId&&node2Partition!=""){const newSelectionLink=selectionGraph.links.find(x=>x.source.id==selectionId&&x.target.id==node2Partition),previousSelectionLink=selectionGraph.links.find(x=>x.source.id==previousGroup&&x.target.id==node2Partition);previousSelectionLink.value=previousSelectionLink.value-value;newSelectionLink.value=previousSelectionLink.value+value}else if(targetId==nodeId&&node1Partition!=""){const previousSelectionLink=selectionGraph.links.find(x=>x.source.id==node1Partition&&x.target.id==previousGroup),newSelectionLink=selectionGraph.links.find(x=>x.source.id==node1Partition&&x.target.id==selectionId);previousSelectionLink.value=previousSelectionLink.value-value;newSelectionLink.value=previousSelectionLink.value+value}});const previousSelectionNode=selectionGraph.nodes.find(x=>x.id==previousGroup);previousSelectionNode.nonodes=previousSelectionNode.nonodes-1}else link.filter(function(l){return l.source.id==nodeId||l.target.id==nodeId}).each(function(l){var newSelectionLink;const{source:{id:sourceId},target:{id:targetId},value}=l,{[sourceId]:node1Partition,[targetId]:node2Partition}=graph.partitions;sourceId==nodeId&&node2Partition!=""?(newSelectionLink=selectionGraph.links.find(sl=>sl.source.id==selectionId&&sl.target.id==node2Partition),newSelectionLink.value=newSelectionLink.value+value):targetId==nodeId&&node1Partition!=""&&(newSelectionLink=selectionGraph.links.find(sl=>sl.source.id==node1Partition&&sl.target.id==selectionId),newSelectionLink.value=newSelectionLink.value+value)});const newSelectionNode=selectionGraph.nodes.find(x=>x.id==selectionId);newSelectionNode.nonodes=newSelectionNode.nonodes+1;graph.partitions[d.id]=selectionId}).style("fill",function(d){const heading=document.getElementById("heading-"+d.id);return heading.style.backgroundColor=newColour,heading.style.color="hsl(0, 0%, "+String(lightness)+"%)",newColour});selectionNode.select("title").text(function(d){return"Number of Nodes: "+d.nonodes});selectionLink.select("title").text(function(d){return d.value})},deleteAllSelections=function(graphRef){graphRef.clearPartitions();selectionGraph.nodes=[];selectionGraph.links=[];updateSelectionNodesAndLinks();document.getElementById("list-selections").innerHTML="";document.getElementById("partition-colour-list").innerHTML="";updateNodeAndLinkColour(node,link)},deleteSelection=function(event,selectionId){event.stopPropagation();const selectionPanel=document.getElementById("selection_panel_"+selectionId);selectionPanel.parentNode.removeChild(selectionPanel);const lightness=fontLightness(forceProperties.colouring.network),nodesFromDeletedPartition=node.filter(function(d){return graph.partitions[d.id]==selectionId});forceProperties.attributeColouring.enabled?nodesFromDeletedPartition.each(function(d){return d3.select("#heading-"+d.id).style("background-color",forceProperties.colouring.network).style("color","hsl(0, 0%, "+String(lightness)+"%)"),graph.partitions[d.id]="",forceProperties.colouring.network}):nodesFromDeletedPartition.style("fill",function(d){return link.filter(function(l){return l.source.id===d.id}).style("stroke",forceProperties.colouring.network),d3.select("#heading-"+d.id).style("background-color",forceProperties.colouring.network).style("color","hsl(0, 0%, "+String(lightness)+"%)"),graph.partitions[d.id]="",forceProperties.colouring.network});selectionGraph.nodes=selectionGraph.nodes.filter(function(n){return n.id!=selectionId});selectionGraph.links=selectionGraph.links.filter(function(d){return d.source.id!=selectionId&&d.target.id!=selectionId});updateSelectionNodesAndLinks()},stringifyCommunityDetectionLinkReplacer=function(key,value){switch(key){case"source":case"target":return value.id;default:return value}},fillPartitionsWithAttribute=function(attributeName,currentGraphRef){for(const node in currentGraphRef.nodes)currentGraphRef.setPartition(node,currentGraphRef.getNodeDataValue(node,attributeName))},assignAttributePartitions=function(attributeSelect,currentGraphRef){deleteAllSelections(currentGraphRef);const attributeName=document.getElementById(attributeSelect).value;if(attributeName==="modularity"){requestCommunityDetection();return}const attributesDistinctValues=currentGraphRef.getDistinctValues(attributeName);fillPartitionsWithAttribute(attributeName,currentGraphRef);const mccObject=matthewsCorrelationCoeficient();for(const value of attributesDistinctValues)addNewSelection(value,mccObject);updateSelectionNodesAndLinks();updateNodeAndLinkColour(node,link)},matthewsCorrelationCoeficient=function(){const distinctPartitions=currentGraph.getDistinctPartitions(),distinctClasses=currentGraph.getDistinctClasses();if(!distinctClasses||!distinctPartitions)return null;const confusionMatrices={};for(const partition of distinctPartitions){confusionMatrices[partition]={};const partitionObject=confusionMatrices[partition];for(const className of distinctClasses)partitionObject[className]={TP:0,FN:0,TN:0,FP:0}}for(const[node,nodePartition]of Object.entries(currentGraph.partitions)){const nodeRealClass=currentGraph.getClass(node);for(const partition in confusionMatrices){if(partition===nodePartition){for(const className in confusionMatrices[partition]){if(className===nodeRealClass){confusionMatrices[partition][className].TP+=1;continue}confusionMatrices[partition][className].FP+=1}continue}for(const className in confusionMatrices[partition]){if(className===nodeRealClass){confusionMatrices[partition][className].FN+=1;continue}confusionMatrices[partition][className].TN+=1}}}const mccObject={};for(const partition of distinctPartitions){mccObject[partition]=[];const partitionArray=mccObject[partition];for(const className of distinctClasses){const{TP,FP,FN,TN}=confusionMatrices[partition][className],mccNumerator=TN*TP-FN*FP,mccDenominator=Math.sqrt((TP+FP)*(TP+FN)*(TN+FP)*(TN+FN)),mcc=mccNumerator/mccDenominator;partitionArray.push({className:className,value:mcc})}}return mccObject},requestCommunityDetection=function(){const nodes_string=JSON.stringify(currentGraph.nodes,["id"]),links_string=JSON.stringify(currentGraph.links,stringifyCommunityDetectionLinkReplacer);$.ajax({url:"/Home/GraphCommunityDetection",type:"POST",data:{nodes:nodes_string,links:links_string},success:function(result){deleteAllSelections(currentGraph);currentGraph.partitions=JSON.parse(result.newPartitions);selectionGraph=JSON.parse(result.newSelections);const mccObject=matthewsCorrelationCoeficient(),partitionColourList=d3.select("#partition-colour-list");selectionGraph.nodes.forEach(function(d){const selectionId=d.id.toString(),idWithoutWhitespaces=removeSpacesAndCommas(selectionId);addSelectionDiv(idWithoutWhitespaces,mccObject);addListColour(idWithoutWhitespaces,"partition",partitionColourList)});updateSelectionNodesAndLinks();setPartitionColouring("partition-colour-list")},error:function(xhr,ajaxOptions,thrownError){alert(thrownError)}})},attributeTransform={},excludedAttributes=[],updateRemodelOptionsHeader=function(headerId,attributeSelectId){const header=document.getElementById(headerId),attributeSelect=document.getElementById(attributeSelectId);header.innerHTML=attributeSelect.value+" remodeling options"},displayAttributeTransformation=function(attribute,transformationListId){d3.select("#"+transformationListId).html("");const{[attribute]:transformations}=attributeTransform;if(transformations)for(const transformation of transformations){const transformationName=transformation.charAt(0).toUpperCase()+transformation.slice(1);addTransformationElement(transformationListId,transformation,transformationName)}},updateRemodelingAttributes=function(optionCheckbox,attributeSelectId){const attributeSelect=document.getElementById(attributeSelectId),attribute=optionCheckbox.value;if(!optionCheckbox.checked){excludedAttributes.push(attribute);return}for(let i=0;i<excludedAttributes.length;i++)if(excludedAttributes[i]===attribute){excludedAttributes.splice(i,1);return}},deleteAllTransformations=function(){attributeTransform={};document.getElementById("attribute-transformation-list").innerHTML=""},clearAttributeTransformations=function(attributeSelectId){document.getElementById("attribute-transformation-list").innerHTML="";const attribute=document.getElementById(attributeSelectId).value;attributeTransform[attribute]&&delete attributeTransform[attribute]},deleteTransformation=function(deleteBtn){const transformationItem=deleteBtn.parentElement,selectedAttribute=document.getElementById("remodel-network-select").value,transformationItemIndex=$(transformationItem).index();attributeTransform[selectedAttribute].splice(transformationItemIndex,1);transformationItem.remove()},transformationDragStart=function(e){var index=$(e.currentTarget).index();e.dataTransfer.setData("text/plain",index)},transformationDrop=function(e){cancelDefaultBehaviour(e);const selectedAttribute=document.getElementById("remodel-network-select").value;this.classList.remove("transformation-dragover");const oldIndex=parseInt(e.dataTransfer.getData("text/plain")),target=$(e.currentTarget),newIndex=target.index();if(newIndex!==oldIndex){const transformArray=attributeTransform[selectedAttribute],temp=transformArray[newIndex];transformArray[newIndex]=transformArray[oldIndex];transformArray[oldIndex]=temp;let dropped=$(this).parent().children().eq(oldIndex).remove();newIndex<oldIndex?target.before(dropped):target.after(dropped)}},transformationDragOver=function(e){cancelDefaultBehaviour(e);this.classList.add("transformation-dragover")},transformationDragLeave=function(e){cancelDefaultBehaviour(e);this.classList.remove("transformation-dragover")},addToTransformationList=function(attribute,transformationType){attribute in attributeTransform||(attributeTransform[attribute]=[]);attributeTransform[attribute].push(transformationType)},addTransformationElement=function(transformationListId,transformationType,transformationName){const newTransformationListItem=d3.select("#"+transformationListId).append("li").classed("transformation-li",!0).attr("draggable",!0).attr("data-role",transformationType);newTransformationListItem.node().addEventListener("dragstart",transformationDragStart,!0);newTransformationListItem.node().addEventListener("drop",transformationDrop,!0);newTransformationListItem.node().addEventListener("dragover",transformationDragOver,!0);newTransformationListItem.node().addEventListener("dragenter",cancelDefaultBehaviour,!0);newTransformationListItem.node().addEventListener("dragleave",transformationDragLeave,!0);newTransformationListItem.append("h5").text(transformationName);newTransformationListItem.append("button").text("Delete").on("click",function(){deleteTransformation(this)})},addTransformation=function(transformationBtn,attributeSelectId,transformationListId){const transformationControlElement=transformationBtn.parentElement,transformationName=transformationControlElement.firstElementChild.innerHTML,transformationType=transformationControlElement.getAttribute("data-role"),attributeSelect=document.getElementById(attributeSelectId),attribute=attributeSelect.value;attribute!==""&&attribute!==undefined&&(addToTransformationList(attribute,transformationType),addTransformationElement(transformationListId,transformationType,transformationName))},addTransformationToAll=function(transformationBtn,attributeSelectId){const transformationControlElement=transformationBtn.parentElement,transformationName=transformationControlElement.firstElementChild.innerHTML,transformationType=transformationControlElement.getAttribute("data-role"),attributeSelect=document.getElementById(attributeSelectId),selectedAttribute=attributeSelect.value;if(selectedAttribute!==""&&selectedAttribute!==undefined){for(let attribute of attributeSelect.options)addToTransformationList(attribute.value,transformationType);addTransformationElement("attribute-transformation-list",transformationType,transformationName)}},remodelNetwork=function(checkboxesDivId,algorithmSelectId,metricSelectId,nulifyId){const selectedAlgorithm=document.getElementById(algorithmSelectId).value,selectedMetric=document.getElementById(metricSelectId).value,nulify=document.getElementById(nulifyId).checked,networkRemodelParams={metric:{name:selectedMetric,params:[],nulify:nulify},algorithm:{name:selectedAlgorithm,params:[]}};switch(selectedMetric){case"GaussKernel":const metricParams=networkRemodelParams.metric.params,sigma=parseFloat(document.getElementById("sigma").value);metricParams.push(sigma)}const selectedParametersDiv=selectedAlgorithm.toLowerCase()+"-parameters-remodel",algorithmParametersDiv=document.getElementById(selectedParametersDiv),parameterInputs=algorithmParametersDiv.querySelectorAll("input[type=number]"),algorithmParams=networkRemodelParams.algorithm.params;for(const parameter of parameterInputs)algorithmParams.push(parseFloat(parameter.value));const nodes_string=JSON.stringify(dataStore.getNodeData),attributes_string=JSON.stringify(currentGraph.attributes),attribute_transform_string=JSON.stringify(attributeTransform),network_remodel_params_string=JSON.stringify(networkRemodelParams),excluded_attributes_string=JSON.stringify(excludedAttributes);$.ajax({url:"/Home/RemodelNetwork",type:"POST",data:{nodes:nodes_string,attributes:attributes_string,attributeTransform:attribute_transform_string,networkRemodelParams:network_remodel_params_string,excludedAttributes:excluded_attributes_string},success:function(result){if(result.newVectorData!=""){const newVectorData=JSON.parse(result.newVectorData);dataStore.nodes=newVectorData}const newNet=JSON.parse(result.newNetwork);currentGraph.links=newNet;currentGraph.updateLinkIndeces();updateNodesAndLinks();requestCommunityDetection(currentGraph);calculateAllMetrics();currentGraph.resetSimulation()},error:function(xhr,ajaxOptions,thrownError){alert(thrownError)}})},freedmanDiaconisRule=function(currentGraph,attribute){let IQRValue=IQR(nodes,attribute);return IQRValue===0&&(IQRValue=IQRValue+1),Math.ceil(2*IQRValue*Math.pow(nodes.length,-1/3))},sigmaG1=function(n){return Math.sqrt(6*(n-2)/((n+1)*(n+3)))},dormanFormula=function(attributeValues){const nodeCount=attributeValues.length,attributeSkewness=skewness(attributeValues),attributeSigmaG1=sigmaG1(nodeCount);return 1+Math.log2(nodeCount)+Math.log2(1+Math.abs(attributeSkewness)/attributeSigmaG1)},hist=function(containerDivId,currentGraph,attribute){const attributeValues=currentGraph.getAllAttributeValues(attribute),nBins=dormanFormula(attributeValues),histogramMargin={top:10,right:10,bottom:20,left:25},histogramWidth=300-(histogramMargin.left+histogramMargin.right),histogramHeight=250-(histogramMargin.top+histogramMargin.bottom),xMin=d3.min(attributeValues),xMax=d3.max(attributeValues),xAxis=createLinearAxis(xMin,xMax,0,histogramWidth),histogram=d3.histogram().domain(xAxis.domain()).thresholds(xAxis.ticks(nBins)),bins=histogram(attributeValues),yMax=d3.max(bins,function(d){return d.length}),yAxis=createLinearAxis(0,yMax,histogramHeight,0),plotContainer=getPlotContainer(containerDivId),histogramSvg=createGraphSvg(plotContainer,histogramWidth,histogramHeight,histogramMargin,attribute);appendGraphXAxis(histogramSvg,xAxis,0,histogramHeight);appendGraphYAxis(histogramSvg,yAxis,0,0);appendHistogramBins(histogramSvg,bins,histogramHeight,xAxis,yAxis)},appendHistogramBins=function(svg,bins,height,xAxis,yAxis){return svg.selectAll("rect").data(bins).enter().append("rect").attr("x",1).attr("data-max-value",function(d){return d.x1}).attr("transform",function(d){return"translate("+xAxis(d.x0)+","+yAxis(d.length)+")"}).attr("width",function(d){return xAxis(d.x1)-xAxis(d.x0)-1}).attr("height",function(d){return height-yAxis(d.length)}).style("fill","#ffeead"),svg},barplot=function(containerDivId,data,yMin,yMax,cluster){const barplotMargin={top:10,right:10,bottom:30,left:25},barplotWidth=300-(barplotMargin.left+barplotMargin.right),barplotHeight=250-(barplotMargin.top+barplotMargin.bottom),xAxis=createBandAxis(data.map(d=>d.className),0,barplotWidth),yAxis=createLinearAxis(yMin,yMax,barplotHeight,0),plotContainer=getPlotContainer(containerDivId),barplotSvg=createGraphSvg(plotContainer,barplotWidth,barplotHeight,barplotMargin,cluster),axisGElement=appendGraphXAxis(barplotSvg,xAxis,0,barplotHeight);tiltAxisText(axisGElement);appendGraphYAxis(barplotSvg,yAxis,0,0);appendLine(barplotSvg,0,barplotWidth,yAxis(0),yAxis(0));const tooltip=createTooltip(plotContainer,cluster),mouseover=createTooltipMouseover(tooltip),mousemove=createTooltipMousemove(tooltip),mouseleave=createTooltipMouseleave(tooltip);createBars(barplotSvg,data,xAxis,yAxis,barplotHeight,"#ffeead",mouseover,mousemove,mouseleave)},createBars=function(svg,data,xAxis,yAxis,height,fillColor,mouseover=null,mousemove=null,mouseleave=null){svg.selectAll("mybar").data(data).enter().append("rect").attr("x",d=>xAxis(d.className)).attr("y",d=>yAxis(Math.max(0,d.value))).attr("width",xAxis.bandwidth()).attr("height",d=>Math.abs(yAxis(d.value)-yAxis(0))).attr("fill",fillColor).on("mouseover",mouseover).on("mousemove",mousemove).on("mouseleave",mouseleave);return svg},createTooltip=function(plotContainer,cluster){return plotContainer.append("div").attr("class","plot-tooltip").attr("id",`${cluster}-tooltip`)},createTooltipMouseover=function(tooltip){return function(d){const{className,value}=d;tooltip.html("Class: "+className+"<br>Value: "+value).style("opacity",1)}},createTooltipMousemove=function(tooltip){return function(){tooltip.style("left",d3.mouse(this)[0]-90+"px").style("top",d3.mouse(this)[1]+"px")}},createTooltipMouseleave=function(tooltip){return function(){tooltip.style("opacity",0)}},getPlotContainer=function(containerDivId){return d3.select(`#${containerDivId}`)},createGraphSvg=function(plotContainer,width,height,margin,attribute){return plotContainer.append("svg").attr("width","100%").attr("height",height+margin.top+margin.bottom).attr("data-attribute",attribute).append("g").attr("transform","translate("+margin.left+","+margin.top+")")},appendGraphXAxis=function(svg,axis,translateX,translateY){return svg.append("g").attr("transform","translate("+translateX+","+translateY+")").call(d3.axisBottom(axis))},tiltAxisText=function(axisGElement){return axisGElement.selectAll("text").attr("transform","translate(-10, 0) rotate(-90)").style("text-anchor","end"),axisGElement},appendGraphYAxis=function(svg,axis,translateX,translateY){return svg.append("g").attr("transform","translate("+translateX+","+translateY+")").call(d3.axisLeft(axis))},appendLine=function(svg,x1,x2,y1,y2){svg.append("g").style("stroke","#000").append("line").attr("x1",x1).attr("x2",x2).attr("y1",y1).attr("y2",y2)},createLinearAxis=function(domainMin,domainMax,rangeMin,rangeMax){return d3.scaleLinear().domain([domainMin,domainMax]).range([rangeMin,rangeMax])},createBandAxis=function(domainValues,rangeMin,rangeMax,padding=.2){return d3.scaleBand().range([rangeMin,rangeMax]).domain(domainValues).padding(padding)};